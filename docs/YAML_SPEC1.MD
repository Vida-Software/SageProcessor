
# Especificaci√≥n YAML para SAGE v1.1.0

## üéØ Introducci√≥n

SAGE utiliza archivos YAML para definir la estructura y reglas de validaci√≥n de datos. Esta especificaci√≥n define la sintaxis y convenciones para crear estas configuraciones.

## üìä Tipos de Datos y Validaciones

### Tipos B√°sicos

| Tipo     | Descripci√≥n              | Validaci√≥n Recomendada                                    | Ejemplo           |
|----------|-------------------------|--------------------------------------------------------|-------------------|
| texto    | Cadenas de texto        | `str.match()`                                          | "ABC123"          |
| decimal  | N√∫meros con decimales   | `astype(float)`                                        | 123.45           |
| entero   | N√∫meros enteros         | `pd.to_numeric(x).apply(lambda x: float(x).is_integer() if pd.notnull(x) else True)` | 42               |
| fecha    | Fechas en formato ISO   | `pd.to_datetime()`                                     | "2025-03-10"     |
| booleano | Valores verdadero/falso | `astype(bool)`                                         | true/false       |

### Reglas de Validaci√≥n Mejoradas

#### Para Enteros
```yaml
validation_rules:
  - name: "Validar Entero"
    description: "El campo debe ser un n√∫mero entero"
    rule: "pd.to_numeric(df['campo']).apply(lambda x: float(x).is_integer() if pd.notnull(x) else True)"
    severity: "error"
```

#### Para Decimales
```yaml
validation_rules:
  - name: "Validar Decimal"
    description: "El campo debe ser un n√∫mero con 2 decimales m√°ximo"
    rule: "df['campo'].astype(float).round(2) == df['campo'].astype(float)"
    severity: "error"
```

## üèóÔ∏è Estructura del YAML

### Secciones Principales

```yaml
sage_yaml:        # Metadatos del YAML
  name: "Nombre"
  description: "Descripci√≥n"
  version: "1.0.0"
  author: "Autor"
  comments: "Comentarios"

catalogs:         # Definici√≥n de cat√°logos
  # ... cat√°logos

packages:         # Definici√≥n de paquetes
  # ... paquetes
```

### Definici√≥n de Cat√°logos

```yaml
catalogs:
  nombre_catalogo:
    name: "Nombre del Cat√°logo"
    description: "Descripci√≥n"
    filename: "archivo.ext"
    file_format:
      type: "CSV|EXCEL"
      delimiter: ","        # Solo para CSV
      header: true         # Indica si tiene encabezados
    
    fields:
      - name: "campo"
        type: "tipo_dato"
        required: true|false
        unique: true|false
        validation_rules:
          - name: "Nombre Regla"
            description: "Descripci√≥n amigable"
            rule: "expresi√≥n pandas"
            severity: "error|warning"

    catalog_validation:    # Validaciones a nivel cat√°logo
      - name: "Nombre"
        description: "Descripci√≥n"
        rule: "expresi√≥n pandas"
        severity: "error|warning"
```

### Definici√≥n de Paquetes

```yaml
packages:
  nombre_paquete:
    name: "Nombre del Paquete"
    description: "Descripci√≥n"
    file_format:
      type: "ZIP|CSV|EXCEL"
    catalogs:
      - catalogo1
      - catalogo2
    package_validation:
      - name: "Nombre"
        description: "Descripci√≥n"
        rule: "expresi√≥n pandas"
        severity: "error|warning"
```

## üí° Mejores Pr√°cticas

### Validaciones Num√©ricas
1. Usar `pd.to_numeric()` para conversi√≥n segura
2. Implementar `float(x).is_integer()` para enteros
3. Manejar NaN/null con `pd.notnull()`
4. Usar `astype()` solo despu√©s de validar tipo

### Mensajes de Error
1. Usar lenguaje amigable y emoji
2. Incluir sugerencias de correcci√≥n
3. Ser espec√≠fico pero conciso

### Ejemplos Pr√°cticos

#### Validaci√≥n de Enteros
```yaml
validation_rules:
  - name: "C√≥digo Num√©rico"
    description: "¬°Hey! El c√≥digo debe ser un n√∫mero entero üî¢"
    rule: "pd.to_numeric(df['codigo']).apply(lambda x: float(x).is_integer() if pd.notnull(x) else True)"
    severity: "error"
```

#### Validaci√≥n de Fechas
```yaml
validation_rules:
  - name: "Fecha V√°lida"
    description: "¬°La fecha debe estar en formato YYYY-MM-DD! üìÖ"
    rule: "pd.to_datetime(df['fecha'], errors='coerce').notnull()"
    severity: "error"
```

#### Validaci√≥n Entre Cat√°logos
```yaml
package_validation:
  - name: "Referencias V√°lidas"
    description: "¬°Ups! Algunos c√≥digos no existen en el cat√°logo maestro üîç"
    rule: "df['ventas']['codigo'].isin(df['productos']['codigo'])"
    severity: "error"
```

## üìù Notas Importantes

1. Las validaciones de enteros ahora usan `float(x).is_integer()` para mayor precisi√≥n
2. Se recomienda usar `pd.to_numeric()` antes de validaciones num√©ricas
3. Los mensajes de error deben ser constructivos y amigables
4. Las reglas deben manejar casos nulos apropiadamente
5. La severidad determina c√≥mo se maneja el error (error/warning)

## üîÑ Compatibilidad

Esta especificaci√≥n es compatible con versiones anteriores pero introduce mejoras en:
- Validaci√≥n de tipos num√©ricos
- Manejo de valores nulos
- Mensajes de error
- Reglas entre cat√°logos

